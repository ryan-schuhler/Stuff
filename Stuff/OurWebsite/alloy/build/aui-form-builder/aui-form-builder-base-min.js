AUI.add("aui-form-builder-base",function(x){var l=x.Lang,N=l.isArray,W=l.isBoolean,m=l.isString,ae=l.isObject,D=x.Array,ao=x.AvailableField.getAvailableFieldById,n=function(A){return(A instanceof x.AvailableField);},ab=function(A){return(A instanceof x.FormBuilderField);},Q="add",S="allowRemoveRequiredFields",ah="attributeName",Y="availableField",w="availableFields",an="boundingBox",av="builder",ai="click",s="data",J="dblclick",c="dd",aa="diagram",q="draggable",h="dragging",aj="drop",g="editing",ad="",u="field",R="fields",au="fieldsNestedListConfig",a="form",O="formBuilder",E="hiddenAttributes",I="id",ap="label",k="localizationMap",X="name",ar="node",at="options",al="parent",p="parentNode",v="placeholder",V="predefinedValue",F="readOnlyAttributes",f="remove",ak="rendered",C="required",P="selected",o="showLabel",T="tip",B="type",Z="unique",am="value",e="width",U="zone",H=".",G="",aq="_",j=x.getClassName,b=w+aq+u+aq,d=R+aq+u+aq,r=j(c,h),y=j(aa,av,u,q),ac=j(a,av,aj,U),z=j(a,av,u),t=j(a,av,u,g),af=j(a,av,v),K=[I,X],M='<div class="'+af+'"></div>';var ag=x.Component.create({NAME:Y,ATTRS:{hiddenAttributes:{value:[],validator:N},name:{value:G},options:{validator:ae},predefinedValue:{value:G},readOnlyAttributes:{value:[],validator:N},required:{validator:W,value:false},showLabel:{validator:W,value:true},tip:{validator:m,value:G},unique:{value:false,validator:W},width:{}},EXTENDS:x.AvailableField});x.FormBuilderAvailableField=ag;var i=x.Component.create({NAME:O,ATTRS:{allowRemoveRequiredFields:{validator:W,value:false},autoSelectFields:{value:false},enableEditing:{value:true},fieldsNestedListConfig:{setter:"_setFieldsNestedListConfig",validator:ae,value:null},strings:{value:{addNode:"Add field",cancel:"Cancel",propertyName:"Property Name",save:"Save",settings:"Settings",value:"Value"}}},UI_ATTRS:[S],EXTENDS:x.DiagramBuilderBase,FIELDS_TAB:0,SETTINGS_TAB:1,prototype:{uniqueFields:new x.DataSet(),initializer:function(){var A=this;A.on({cancel:A._onCancel,"drag:end":A._onDragEnd,"drag:start":A._onDragStart,"drag:mouseDown":A._onDragMouseDown,save:A._onSave});A.uniqueFields.after(Q,x.bind(A._afterUniqueFieldsAdd,A));A.uniqueFields.after(f,x.bind(A._afterUniqueFieldsRemove,A));A.dropContainer.delegate(ai,x.bind(A._onClickField,A),H+z);A.dropContainer.delegate(J,x.bind(A._onDblClickField,A),H+z);},syncUI:function(){var A=this;A._setupAvailableFieldsNestedList();A._setupFieldsNestedList();},closeEditProperties:function(){var A=this;var L=A.editingField;A.tabView.selectTab(x.FormBuilder.FIELDS_TAB);if(L&&L.get(ak)){L.get(an).removeClass(t);}A.editingField=null;},createField:function(L){var A=this;if(!ab(L)){L=new (A.getFieldClass(L.type||u))(L);}L.set(av,A);L.set(al,A);return L;},duplicateField:function(aw){var A=this;var L=A._getFieldNodeIndex(aw.get(an));var ax=A._cloneField(aw,true);A.insertField(ax,++L,aw.get(al));},editField:function(L){var A=this;if(ab(L)){A.closeEditProperties();A.tabView.selectTab(x.FormBuilder.SETTINGS_TAB);A.propertyList.set(s,A.getFieldProperties(L));L.get(an).addClass(t);A.editingField=A.selectedField=L;}},getFieldClass:function(aw){var A=this;var L=x.FormBuilder.types[aw];if(L){return L;}else{x.log("The field type: ["+aw+"] couldn't be found.");return null;}},getFieldProperties:function(L){var A=this;return L.getProperties();},insertField:function(ax,L,aw){var A=this;aw=aw||A;ax.get(al).removeField(ax);aw.addField(ax,L);},plotField:function(ax,L){var A=this;var aw=ax.get(an);if(!ax.get(ak)){ax.render(L);}else{L.append(aw);}A._syncUniqueField(ax);A.fieldsNestedList.add(aw);},plotFields:function(L,aw){var A=this;aw=aw||A.dropContainer;L=L||A.get(R);aw.setContent(ad);x.each(L,function(ax){A.plotField(ax,aw);});},select:function(L){var A=this;A.unselectFields();A.selectedField=L.set(P,true).focus();},unselectFields:function(){var A=this;var L=A.selectedField;if(L){L.set(P,false);}A.selectedField=null;},_afterUniqueFieldsAdd:function(aw){var A=this;var ax=aw.attrName;if(n(ax)){var L=ax.get(ar);ax.set(q,false);L.unselectable();}},_afterUniqueFieldsRemove:function(aw){var A=this;var ax=aw.attrName;if(n(ax)){var L=ax.get(ar);ax.set(q,true);L.selectable();}},_cloneField:function(ax,L){var A=this;var aw={};D.each(A.getFieldProperties(ax),function(az){var ay=az.attributeName;if(D.indexOf(K,ay)===-1){aw[ay]=az.value;}});if(L){aw[R]=[];x.each(ax.get(R),function(az,ay){if(!az.get(Z)){aw[R][ay]=A._cloneField(az,L);}});}return A.createField(aw);},_dropField:function(az){var L=this;var aB=az.getData(Y);var aA=x.Widget.getByNode(az);var A=az.get(p);if(n(aB)){var ax={hiddenAttributes:aB.get(E),label:aB.get(ap),localizationMap:aB.get(k),options:aB.get(at),predefinedValue:aB.get(V),readOnlyAttributes:aB.get(F),required:aB.get(C),showLabel:aB.get(o),tip:aB.get(T),type:aB.get(B),unique:aB.get(Z),width:aB.get(e)};if(ax.unique){ax.id=L._getFieldId(aB);ax.name=aB.get(X);}aA=L.createField(ax);}if(ab(aA)){var ay=x.Widget.getByNode(A);if(!ab(ay)){ay=L;}var aw=L._getFieldNodeIndex(az);L.insertField(aA,aw,ay);L.select(aA);}},_getFieldId:function(aw){var A=this;var ax=aw.get(I);var L;if(n(aw)){L=b;}else{L=d;}return ax.replace(L,G);},_getFieldNodeIndex:function(L){var A=this;return L.get(p).all("> *:not("+H+af+")").indexOf(L);},_onClickField:function(L){var A=this;var aw=x.Widget.getByNode(L.currentTarget);A.select(aw);L.stopPropagation();},_onDblClickField:function(L){var A=this;if(!L.target.ancestor(H+z,true)){return;}var aw=x.Widget.getByNode(L.currentTarget);if(aw){A.editField(aw);}L.stopPropagation();},_onDragEnd:function(aw){var A=this;var L=aw.target;var ax=L.get(ar);A._dropField(ax);if(!ab(x.Widget.getByNode(ax))){ax.remove();L.set(ar,A._originalDragNode);}},_onDragMouseDown:function(L){var A=this;var aw=L.target.get(ar);var ax=x.AvailableField.getAvailableFieldByNode(aw);if(n(ax)&&!ax.get(q)){L.halt();}},_onDragStart:function(ax){var A=this;var aw=ax.target;var az=aw.get(ar);if(ab(x.Widget.getByNode(az))){return;}A._originalDragNode=az;var ay=az.clone();az.placeBefore(ay);aw.set(ar,ay);var L=az.getData(Y);
ay.setData(Y,L);ay.attr(I,ad);ay.hide();az.removeClass(r);az.show();A.fieldsNestedList.add(ay);},_onSave:function(ax){var A=this;var aw=A.editingField;if(aw){var L=A.propertyList.get(s);L.each(function(ay){aw.set(ay.get(ah),ay.get(am));});A._syncUniqueField(aw);}},_setAvailableFields:function(aw){var L=this;var A=[];D.each(aw,function(ay,ax){A.push(n(ay)?ay:new x.FormBuilderAvailableField(ay));});return A;},_setFieldsNestedListConfig:function(aw){var A=this;var L=A.dropContainer;return x.merge({bubbleTargets:A,dd:{groups:[w],plugins:[{cfg:{horizontal:false,scrollDelay:150},fn:x.Plugin.DDWinScroll}]},dropCondition:function(ay){var ax=ay.drop.get(ar);var az=x.Widget.getByNode(ax);if(ab(az)){return true;}return false;},placeholder:x.Node.create(M),dropOn:H+ac,sortCondition:function(ay){var ax=ay.drop.get(ar);return(ax!==A.dropContainer&&L.contains(ax));}},aw||{});},_setupAvailableFieldsNestedList:function(){var A=this;if(!A.availableFieldsNestedList){var L=A.fieldsContainer.all(H+y);A.availableFieldsNestedList=new x.NestedList(x.merge(A.get(au),{nodes:L}));}},_setupFieldsNestedList:function(){var A=this;if(!A.fieldsNestedList){A.fieldsNestedList=new x.NestedList(A.get(au));}},_syncUniqueField:function(aw){var A=this;var L=A.uniqueFields;var ax=ao(A._getFieldId(aw));if(n(ax)){if(ax.get(Z)||aw.get(Z)){L.add(ax,aw);}}},_uiSetAllowRemoveRequiredFields:function(L){var A=this;A.get(R).each(function(aw){aw._uiSetRequired(aw.get(C));});}}});x.FormBuilder=i;x.FormBuilder.types={};},"@VERSION@",{skinnable:true,requires:["aui-base","aui-button-item","aui-data-set","aui-diagram-builder-base","aui-nested-list","aui-tabs"]});